<!-- admin -->
<div>
<p>Modify your settings here.</p>

<script>
const handleColorHex = () => {
	const colorhex = document.querySelector("#colorhex");
	const rgb = hexTOrgb(colorhex.value);
	const hsl = rgbTOhsl(rgb);
	console.log(rgb, hsl);

	var xhr = new XMLHttpRequest();
	xhr.open("POST", "/pref", true);
	xhr.setRequestHeader("Content-Type", "application/json");
	xhr.send(`hue=${hsl.h}`);
}
const hexTOrgb = (hex) => {
	let rgb = Object.create(null);
	if (hex[0] == "#") {
		let [R,G,B] = [];
		if (hex.length == 4) {
			R = `0x${hex[1]}${hex[1]}`;
			G = `0x${hex[2]}${hex[2]}`;
			B = `0x${hex[3]}${hex[3]}`;
		} else if (hex.length == 7) {
			R = `0x${hex[1]}${hex[2]}`;
			G = `0x${hex[3]}${hex[4]}`;
			B = `0x${hex[5]}${hex[6]}`;
		}
		rgb = {"r":+R,"g":+G,"b":+B};
		Object.setPrototypeOf(rgb, null);
	}
	return rgb;
}
const rgbTOhsl = rgb => {
	let hsl = Object.create(null);
	if (rgb.r !== undefined && rgb.g !== undefined && rgb.b !== undefined ) {
		let [R,G,B] = [ rgb.r, rgb.g, rgb.b ]
		const M = Math.max(R, G, B);
		const m = Math.min(R, G, B);
		const L = (M + m) / 255 / 2;
		const S = (M - m) / 255 / (1 - Math.abs(2*L - 1));
		const H = Math.acos((R - G/2 - B/2) / Math.sqrt( R*R + G*G + B*B - R*G - R*B - G*B )) / Math.PI / 2;
		const round = (num) => Math.round((num + Number.EPSILON) * 1000000) / 1000000;
		hsl = {"h":round(H * 360),"s":round(S * 100),"l":round(L * 100)};
		Object.setPrototypeOf(hsl, null);
	}
	return hsl;
};
</script>
<label for="colorhex">Color (HEX): </label><input id="colorhex" name="colorhex" type="text" maxlength="7" size="7" placeholder="#000000"> <button onclick="handleColorHex()">Apply</button>
</div>

